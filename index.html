<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- CSP Removed: Third-party extensions were causing conflicts. Static site doesn't need strict CSP. -->
    <title>PhysioAssist - AI Recovery</title>

    <!-- PERFORMANCE OPTIMIZATION v2.69: Preload critical fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style"
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
        media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap">
    </noscript>

    <link rel="stylesheet" href="styles.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè•</text></svg>">

    <!-- PERFORMANCE v2.69: Defer heavy AI libraries until needed -->
    <!-- TensorFlow.js & PDF.js loaded async - not needed for initial form render -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" defer></script>
</head>

<body>

    <!-- v2.69: LANGUAGE SELECTION POPUP (First interaction before form) -->
    <div class="language-popup-overlay" id="languagePopup">
        <div class="language-popup">
            <div class="language-popup-header">
                <span class="language-icon">üåê</span>
                <h2>Choose Your Language</h2>
                <p>‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç</p>
            </div>
            <div class="language-options">
                <button class="language-btn" onclick="selectLanguage('english')">
                    <span class="lang-flag">üá¨üáß</span>
                    <span class="lang-name">English</span>
                </button>
                <button class="language-btn" onclick="selectLanguage('hindi')">
                    <span class="lang-flag">üáÆüá≥</span>
                    <span class="lang-name">‡§π‡§ø‡§Ç‡§¶‡•Ä</span>
                </button>
                <button class="language-btn" onclick="selectLanguage('hinglish')">
                    <span class="lang-flag">üîÄ</span>
                    <span class="lang-name">Hinglish</span>
                    <span class="lang-desc">Mix of Both</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Dynamic Background -->
    <div class="dynamic-bg">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <!-- Main Application -->
    <div class="app-container">

        <!-- Immersive Hero Header -->
        <header class="hero-section">
            <div class="hero-content">
                <div class="logo-badge"><span class="logo-icon">üè•</span></div>
                <h1>PhysioAssist</h1>
                <p>AI-Powered Recovery Intelligence</p>
            </div>
            <div class="wave-shape">
                <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"
                    preserveAspectRatio="none">
                    <path
                        d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z"
                        class="shape-fill"></path>
                </svg>
                </svg>
            </div>
    </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">

        <!-- WIZARD FORM SECTION -->
        <section id="formSection" class="section active">
            <div class="glass-panel">
                <div class="panel-header">
                    <h2>üìã Patient Profile</h2>
                    <span class="step-indicator" id="stepIndicator">Step 1 of 4</span>
                </div>

                <form id="patientForm" class="compact-form">

                    <!-- STEP 1: PERSONAL IDENTITY -->
                    <div class="form-step active" id="step1">
                        <div class="input-group">
                            <div class="floating-input">
                                <input type="text" id="name" name="name" required placeholder=" " class="input-field">
                                <label for="name" data-translate="fullName">Full Name</label>
                            </div>
                            <div class="floating-input">
                                <input type="tel" id="mobile" name="mobile" required placeholder=" " class="input-field"
                                    pattern="[0-9]{10}" maxlength="10" autocomplete="tel">
                                <label for="mobile" data-translate="mobile">Mobile Number</label>
                            </div>
                            <div class="row-inputs">
                                <div class="floating-input">
                                    <input type="number" id="age" name="age" required placeholder=" "
                                        class="input-field">
                                    <label for="age" data-translate="age">Age</label>
                                </div>
                                <div class="floating-input">
                                    <select id="gender" name="gender" required class="input-field">
                                        <option value="" disabled selected hidden></option>
                                        <!-- Placeholder Magic -->
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <label for="gender" data-translate="gender">Gender</label>
                                </div>
                            </div>
                            <div class="row-inputs">
                                <div class="floating-input">
                                    <input type="number" id="weight" name="weight" required placeholder=" "
                                        class="input-field" min="20" max="200" step="0.1">
                                    <label for="weight" data-translate="weight">Weight (kg)</label>
                                </div>
                                <div class="floating-input">
                                    <input type="number" id="height" name="height" required placeholder=" "
                                        class="input-field" min="100" max="220">
                                    <label for="height" data-translate="height">Height (cm)</label>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="nextStep(2)">Next: Lifestyle
                            ‚ûî</button>
                    </div>

                    <!-- STEP 2: LIFESTYLE -->
                    <div class="form-step hidden" id="step2">
                        <div class="input-group">
                            <div class="floating-input">
                                <input type="text" id="occupation" name="occupation" placeholder=" "
                                    class="input-field">
                                <label for="occupation" data-translate="occupation">Occupation</label>
                            </div>
                            <!-- NEW: Activity Field (v2.7) -->
                            <div class="floating-input">
                                <input type="text" id="activity" name="activity" placeholder=" " class="input-field">
                                <label for="activity" data-translate="activity">Daily Activity (e.g. Badminton, Yoga,
                                    Gardening)</label>
                            </div>
                            <div class="floating-input">
                                <select id="dietPreference" name="dietPreference" required class="input-field">
                                    <option value="" disabled selected hidden></option>
                                    <option value="veg">Vegetarian</option>
                                    <option value="non-veg">Non-Vegetarian</option>
                                    <option value="vegan">Vegan</option>
                                    <option value="keto">Keto</option>
                                </select>
                                <label for="dietPreference" data-translate="dietType">Diet Type</label>
                            </div>
                        </div>
                        <div class="nav-buttons">
                            <button type="button" class="btn btn-secondary" onclick="nextStep(1)">Back</button>
                            <button type="button" class="btn btn-primary" onclick="nextStep(3)">Next: Medical
                                History ‚ûî</button>
                        </div>
                    </div>

                    <!-- STEP 3: MEDICAL HISTORY -->
                    <div class="form-step hidden" id="step3">
                        <div class="clinical-group">
                            <h3 data-translate="medicalProfile">Medical Profile</h3>
                            <div class="checkbox-group">
                                <label class="custom-checkbox">
                                    <input type="checkbox" id="condition_diabetes" name="condition_diabetes"
                                        value="yes">
                                    <span data-translate="diabetes">Diabetes</span>
                                </label>
                                <label class="custom-checkbox">
                                    <input type="checkbox" id="condition_bp" name="condition_bp" value="yes">
                                    <span data-translate="highBP">High BP</span>
                                </label>
                                <label class="custom-checkbox">
                                    <input type="checkbox" id="condition_heart" name="condition_heart" value="yes">
                                    <span data-translate="heartIssue">Heart Issue</span>
                                </label>
                            </div>

                            <div class="floating-input" style="margin-top:1rem;">
                                <select id="recentSurgery" name="recentSurgery" class="input-field">
                                    <option value="" disabled selected hidden></option>
                                    <option value="no">No Recent Surgery</option>
                                    <option value="yes_minor">Yes (Minor / < 3 months)</option>
                                    <option value="yes_major">Yes (Major Operation)</option>
                                </select>
                                <label for="recentSurgery" data-translate="recentSurgery">Recent Operations?</label>
                            </div>

                            <!-- UPLOAD SECTION (v2.20) -->
                            <div style="margin-top: 1.5rem; border-top: 1px dashed #E2E8F0; padding-top: 1rem;">
                                <h4 style="margin: 0 0 0.5rem 0; font-size: 0.9rem; color: #475569;">Have an X-Ray, MRI,
                                    or Report? (Optional)</h4>
                                <input type="file" id="reportUpload"
                                    accept="image/jpeg,image/png,image/webp,application/pdf" style="display: none;">
                                <label for="reportUpload"
                                    style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; background: #F1F5F9; border: 2px dashed #94A3B8; border-radius: 8px; padding: 1rem; cursor: pointer; transition: all 0.2s;">
                                    <span style="font-size: 1.5rem;">üìé</span>
                                    <span id="uploadLabelText"
                                        style="color: #64748B; font-size: 0.9rem; font-weight: 500;">Click to Upload
                                        Image/Report (Max 1MB)</span>
                                </label>
                                <div id="previewContainer" style="margin-top: 0.5rem; display: none;">
                                    <div
                                        style="display: flex; align-items: center; gap: 0.5rem; background: #E0F2FE; color: #0369A1; padding: 0.5rem; border-radius: 6px; font-size: 0.85rem;">
                                        <span>‚úÖ</span>
                                        <span id="fileName">report.jpg</span>
                                        <button type="button" id="removeFileBtn"
                                            style="margin-left: auto; background: none; border: none; cursor: pointer; font-size: 1rem;">‚ùå</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="nav-buttons">
                            <button type="button" class="btn btn-secondary" onclick="nextStep(2)">Back</button>
                            <button type="button" class="btn btn-primary" onclick="nextStep(4)">Next: Symptoms
                                ‚ûî</button>
                        </div>
                    </div>

                    <!-- STEP 4: SYMPTOMS -->
                    <div class="form-step hidden" id="step4">
                        <div class="clinical-group">
                            <h3 data-translate="tapHurts">üìç Tap Where It Hurts</h3>

                            <!-- v3.0: SVG-BASED BODY DIAGRAM - Perfect Click Sync -->
                            <div class="svg-body-container" id="bodyDiagramContainer">
                                <!-- View Toggle -->
                                <div class="svg-view-toggle">
                                    <button class="svg-view-btn active" onclick="switchSVGView('front')">üë§
                                        Front</button>
                                    <button class="svg-view-btn" onclick="switchSVGView('back')">üîÑ Back</button>
                                </div>

                                <!-- FRONT VIEW SVG -->
                                < <div class="svg-panel active" id="frontPanel">
                                    <svg viewBox="0 0 200 400" class="body-svg">
                                        <!-- GRADIENT DEFINITIONS for realistic muscle depth -->
                                        <defs>
                                            <linearGradient id="muscleGradLight" x1="0%" y1="0%" x2="100%" y2="0%">
                                                <stop offset="0%" style="stop-color:#f0c4b4;stop-opacity:1" />
                                                <stop offset="50%" style="stop-color:#e8b4b4;stop-opacity:1" />
                                                <stop offset="100%" style="stop-color:#f0c4b4;stop-opacity:1" />
                                            </linearGradient>
                                            <linearGradient id="muscleGradDark" x1="0%" y1="0%" x2="100%" y2="0%">
                                                <stop offset="0%" style="stop-color:#d8a4a4;stop-opacity:1" />
                                                <stop offset="50%" style="stop-color:#e8b4b4;stop-opacity:1" />
                                                <stop offset="100%" style="stop-color:#d8a4a4;stop-opacity:1" />
                                            </linearGradient>
                                        </defs>

                                        <!-- HEAD (organic oval) -->
                                        <ellipse data-region="head" data-name="Head" cx="100" cy="25" rx="20" ry="24"
                                            fill="url(#muscleGradLight)" class="body-part" />

                                        <!-- NECK (trapezoid with curves) -->
                                        <path data-region="neck" data-name="Neck"
                                            d="M88,47 Q92,45 100,45 Q108,45 112,47 L108,62 Q100,64 92,62 Z"
                                            fill="url(#muscleGradLight)" class="body-part" />

                                        <!-- SHOULDERS (deltoid muscle shape with curves) -->
                                        <path data-region="left-shoulder" data-name="Left Shoulder"
                                            d="M55,62 Q60,60 70,62 L85,62 Q90,65 92,75 L88,78 Q75,80 60,85 Q55,82 55,75 Z"
                                            fill="url(#muscleGradDark)" class="body-part" />
                                        <path data-region="right-shoulder" data-name="Right Shoulder"
                                            d="M108,62 L115,62 Q130,60 140,62 Q145,65 145,75 Q140,82 130,85 Q115,80 112,78 L108,75 Q108,65 108,62 Z"
                                            fill="url(#muscleGradDark)" class="body-part" />

                                        <!-- CHEST (pectoralis major - organic muscle shape) -->
                                        <path data-region="chest" data-name="Chest" d="M70,78 Q72,76 85,75 Q100,74 115,75 Q128,76 130,78 
                                               L128,95 Q125,105 120,112 Q115,118 110,120 
                                               Q100,122 90,120 Q85,118 80,112 Q75,105 72,95 Z"
                                            fill="url(#muscleGradLight)" class="body-part" />

                                        <!-- UPPER ARMS (biceps with muscle bulge) -->
                                        <path data-region="left-bicep" data-name="Left Upper Arm" d="M55,85 Q58,83 65,82 L72,82 Q75,85 75,95 Q75,110 72,125 
                                               L70,130 Q62,132 55,132 Q50,128 48,120 Q47,105 50,95 Z"
                                            fill="url(#muscleGradDark)" class="body-part" />
                                        <path data-region="right-bicep" data-name="Right Upper Arm" d="M128,82 L135,82 Q142,83 145,85 Q150,95 153,105 Q152,120 150,128 
                                               Q145,132 135,132 L130,130 Q128,125 125,110 Q125,95 125,85 Z"
                                            fill="url(#muscleGradDark)" class="body-part" />

                                        <!-- ELBOWS (rounded joints) -->
                                        <ellipse data-region="left-elbow" data-name="Left Elbow" cx="46" cy="142" rx="9"
                                            ry="11" fill="url(#muscleGradLight)" class="body-part" />
                                        <ellipse data-region="right-elbow" data-name="Right Elbow" cx="154" cy="142"
                                            rx="9" ry="11" fill="url(#muscleGradLight)" class="body-part" />

                                        <!-- FOREARMS (tapered muscle shape) -->
                                        <path data-region="left-forearm" data-name="Left Forearm" d="M38,152 Q42,150 50,150 L54,152 Q55,165 54,180 Q53,190 50,195 
                                               Q45,196 38,196 Q35,192 35,185 Q35,170 36,160 Z"
                                            fill="url(#muscleGradLight)" class="body-part" />
                                        <path data-region="right-forearm" data-name="Right Forearm" d="M146,152 L150,150 Q158,150 162,152 Q164,160 165,170 Q165,185 165,192 
                                               Q162,196 155,196 L150,195 Q147,190 146,180 Q145,165 146,152 Z"
                                            fill="url(#muscleGradLight)" class="body-part" />

                                        <!-- WRISTS (narrow joints) -->
                                        <rect data-region="left-wrist" data-name="Left Wrist" x="33" y="195" width="20"
                                            height="10" rx="3" fill="url(#muscleGradDark)" class="body-part" />
                                        <rect data-region="right-wrist" data-name="Right Wrist" x="148" y="195"
                                            width="20" height="10" rx="3" fill="url(#muscleGradDark)"
                                            class="body-part" />

                                        <!-- HANDS (organic palm shape) -->
                                        <path data-region="left-hand" data-name="Left Hand" d="M30,205 Q35,203 45,203 L55,205 Q58,215 58,225 L55,230 
                                               Q45,232 35,232 L27,230 Q27,220 28,212 Z" fill="url(#muscleGradLight)"
                                            class="body-part" />
                                        <path data-region="right-hand" data-name="Right Hand" d="M145,203 Q155,203 165,205 L173,207 Q173,217 173,227 L170,230 
                                               Q160,232 150,232 L142,230 Q142,220 142,210 Z"
                                            fill="url(#muscleGradLight)" class="body-part" />

                                        <!-- UPPER ABS (rectus abdominis with 6-pack contour) -->
                                        <path data-region="upper-abs" data-name="Upper Belly" d="M75,120 Q78,118 90,118 Q100,118 110,118 Q122,118 125,120 
                                               L125,135 Q122,145 115,146 Q100,147 85,146 Q78,145 75,135 Z"
                                            fill="url(#muscleGradLight)" class="body-part" />

                                        <!-- LOWER ABS (tapered toward pelvis) -->
                                        <path data-region="lower-abs" data-name="Lower Belly" d="M75,148 Q80,146 92,146 Q100,146 108,146 Q120,146 125,148 
                                               L122,165 Q118,173 112,174 Q100,176 88,174 Q82,173 78,165 Z"
                                            fill="url(#muscleGradLight)" class="body-part" />

                                        <!-- SIDES/WAIST (obliques - curved) -->
                                        <path data-region="left-side" data-name="Left Side" d="M68,120 L72,120 Q72,140 72,155 L72,172 Q70,176 68,178 
                                               Q66,165 66,145 Q66,130 68,120 Z" fill="url(#muscleGradDark)"
                                            class="body-part" />
                                        <path data-region="right-side" data-name="Right Side" d="M128,120 L132,120 Q134,130 134,145 Q134,165 132,178 
                                               Q130,176 128,172 L128,155 Q128,140 128,120 Z"
                                            fill="url(#muscleGradDark)" class="body-part" />

                                        <!-- HIPS (iliac crest with curves) -->
                                        <path data-region="left-hip" data-name="Left Hip" d="M66,178 Q70,176 78,176 L82,178 Q82,190 80,200 L78,205 
   Q70,206 64,204 Q62,195 62,188 Z" fill="url(#muscleGradLight)" class="body-part" />
                                        <path data-region="right-hip" data-name="Right Hip" d="M118,176 L122,176 Q130,176 134,178 Q138,188 138,195 
                                               Q136,204 130,206 L122,205 Q120,200 118,190 Z"
                                            fill="url(#muscleGradLight)" class="body-part" />

                                        <!-- GROIN (pelvis region - subtle) -->
                                        <path data-region="groin" data-name="Groin Area" d="M82,176 Q90,174 100,174 Q110,174 118,176 
                                               L118,195 Q115,205 110,208 Q100,210 90,208 Q85,205 82,195 Z"
                                            fill="url(#muscleGradDark)" class="body-part" />


                                        <!-- UPPER THIGHS -->
                                        <path data-region="left-upper-thigh" data-name="Left Upper Thigh"
                                            d="M62,205 L82,210 L80,260 L60,260 Z" class="body-part" />
                                        <path data-region="right-upper-thigh" data-name="Right Upper Thigh"
                                            d="M118,210 L138,205 L140,260 L120,260 Z" class="body-part" />

                                        <!-- LOWER THIGHS -->
                                        <path data-region="left-lower-thigh" data-name="Left Lower Thigh"
                                            d="M60,260 L80,260 L78,295 L62,295 Z" class="body-part" />
                                        <path data-region="right-lower-thigh" data-name="Right Lower Thigh"
                                            d="M120,260 L140,260 L138,295 L122,295 Z" class="body-part" />

                                        <!-- KNEES -->
                                        <ellipse data-region="left-knee" data-name="Left Knee" cx="70" cy="305" rx="12"
                                            ry="14" class="body-part" />
                                        <ellipse data-region="right-knee" data-name="Right Knee" cx="130" cy="305"
                                            rx="12" ry="14" class="body-part" />

                                        <!-- UPPER SHINS -->
                                        <path data-region="left-upper-shin" data-name="Left Upper Shin"
                                            d="M58,319 L82,319 L80,355 L60,355 Z" class="body-part" />
                                        <path data-region="right-upper-shin" data-name="Right Upper Shin"
                                            d="M118,319 L142,319 L140,355 L120,355 Z" class="body-part" />

                                        <!-- LOWER SHINS -->
                                        <path data-region="left-lower-shin" data-name="Left Lower Shin"
                                            d="M60,355 L80,355 L78,382 L62,382 Z" class="body-part" />
                                        <path data-region="right-lower-shin" data-name="Right Lower Shin"
                                            d="M120,355 L140,355 L138,382 L122,382 Z" class="body-part" />

                                        <!-- ANKLES -->
                                        <rect data-region="left-ankle" data-name="Left Ankle" x="60" y="382" width="20"
                                            height="8" class="body-part" />
                                        <rect data-region="right-ankle" data-name="Right Ankle" x="120" y="382"
                                            width="20" height="8" class="body-part" />

                                        <!-- FEET -->
                                        <path data-region="left-foot" data-name="Left Foot"
                                            d="M55,390 L85,390 L88,400 L52,400 Z" class="body-part" />
                                        <path data-region="right-foot" data-name="Right Foot"
                                            d="M115,390 L145,390 L148,400 L112,400 Z" class="body-part" />
                                    </svg>
                            </div>

                            <!-- BACK VIEW SVG -->
                            <div class="svg-panel" id="backPanel">
                                <svg viewBox="0 0 200 400" class="body-svg">
                                    <!-- HEAD BACK -->
                                    <ellipse data-region="head-back" data-name="Back of Head" cx="100" cy="25" rx="20"
                                        ry="22" class="body-part" />

                                    <!-- NECK BACK -->
                                    <rect data-region="neck-back" data-name="Neck (Back)" x="92" y="47" width="16"
                                        height="15" class="body-part" />

                                    <!-- SHOULDERS BACK -->
                                    <path data-region="left-shoulder-back" data-name="Left Shoulder (Back)"
                                        d="M60,62 L92,62 L92,78 L55,85 Z" class="body-part" />
                                    <path data-region="right-shoulder-back" data-name="Right Shoulder (Back)"
                                        d="M108,62 L140,62 L145,85 L108,78 Z" class="body-part" />

                                    <!-- UPPER BACK -->
                                    <path data-region="upper-back" data-name="Upper Back"
                                        d="M70,78 L130,78 L128,110 L72,110 Z" class="body-part" />

                                    <!-- TRICEPS -->
                                    <path data-region="left-tricep" data-name="Left Tricep"
                                        d="M55,85 L70,78 L72,130 L48,135 Z" class="body-part" />
                                    <path data-region="right-tricep" data-name="Right Tricep"
                                        d="M130,78 L145,85 L152,135 L128,130 Z" class="body-part" />

                                    <!-- ELBOWS BACK -->
                                    <ellipse data-region="left-elbow-back" data-name="Left Elbow (Back)" cx="46"
                                        cy="142" rx="8" ry="10" class="body-part" />
                                    <ellipse data-region="right-elbow-back" data-name="Right Elbow (Back)" cx="154"
                                        cy="142" rx="8" ry="10" class="body-part" />

                                    <!-- FOREARMS BACK -->
                                    <path data-region="left-forearm-back" data-name="Left Forearm (Back)"
                                        d="M38,152 L54,152 L50,195 L35,195 Z" class="body-part" />
                                    <path data-region="right-forearm-back" data-name="Right Forearm (Back)"
                                        d="M146,152 L162,152 L165,195 L150,195 Z" class="body-part" />

                                    <!-- WRISTS BACK -->
                                    <rect data-region="left-wrist-back" data-name="Left Wrist (Back)" x="33" y="195"
                                        width="19" height="10" class="body-part" />
                                    <rect data-region="right-wrist-back" data-name="Right Wrist (Back)" x="148" y="195"
                                        width="19" height="10" class="body-part" />

                                    <!-- HANDS BACK -->
                                    <path data-region="left-hand-back" data-name="Left Hand (Back)"
                                        d="M30,205 L55,205 L58,230 L27,230 Z" class="body-part" />
                                    <path data-region="right-hand-back" data-name="Right Hand (Back)"
                                        d="M145,205 L170,205 L173,230 L142,230 Z" class="body-part" />

                                    <!-- MID BACK -->
                                    <rect data-region="mid-back" data-name="Mid Back" x="72" y="110" width="56"
                                        height="35" class="body-part" />

                                    <!-- LOWER BACK -->
                                    <rect data-region="lower-back" data-name="Lower Back" x="72" y="145" width="56"
                                        height="30" class="body-part" />

                                    <!-- BUTTOCKS -->
                                    <path data-region="left-glute" data-name="Left Buttock"
                                        d="M68,175 L100,175 L100,215 L62,210 Z" class="body-part" />
                                    <path data-region="right-glute" data-name="Right Buttock"
                                        d="M100,175 L132,175 L138,210 L100,215 Z" class="body-part" />

                                    <!-- HAMSTRINGS (BACK OF THIGHS) -->
                                    <path data-region="left-hamstring" data-name="Left Thigh (Back)"
                                        d="M62,210 L100,215 L98,295 L62,295 Z" class="body-part" />
                                    <path data-region="right-hamstring" data-name="Right Thigh (Back)"
                                        d="M100,215 L138,210 L138,295 L102,295 Z" class="body-part" />

                                    <!-- KNEES BACK -->
                                    <ellipse data-region="left-knee-back" data-name="Back of Left Knee" cx="80" cy="305"
                                        rx="20" ry="12" class="body-part" />
                                    <ellipse data-region="right-knee-back" data-name="Back of Right Knee" cx="120"
                                        cy="305" rx="20" ry="12" class="body-part" />

                                    <!-- CALVES -->
                                    <path data-region="left-calf" data-name="Left Calf"
                                        d="M60,317 L100,317 L98,370 L62,370 Z" class="body-part" />
                                    <path data-region="right-calf" data-name="Right Calf"
                                        d="M100,317 L140,317 L138,370 L102,370 Z" class="body-part" />

                                    <!-- ACHILLES -->
                                    <rect data-region="left-achilles" data-name="Left Achilles" x="68" y="370"
                                        width="12" height="15" class="body-part" />
                                    <rect data-region="right-achilles" data-name="Right Achilles" x="120" y="370"
                                        width="12" height="15" class="body-part" />

                                    <!-- HEELS -->
                                    <path data-region="left-heel" data-name="Left Heel"
                                        d="M60,385 L85,385 L88,400 L57,400 Z" class="body-part" />
                                    <path data-region="right-heel" data-name="Right Heel"
                                        d="M115,385 L140,385 L143,400 L112,400 Z" class="body-part" />
                                </svg>
                            </div>
                        </div>

                        <div id="selectedRegionsDisplay" class="selected-regions-display" style="display: none;">
                            <span style="font-size: 0.8rem; color: #92400E;">Selected pain areas:</span>
                            <div id="selectedRegionTags"></div>
                        </div>

                        <p class="body-diagram-hint">üëÜ Tap multiple areas if pain spreads</p>
                        <span class="skip-diagram-link" onclick="toggleTextInput()">Or type location manually
                            ‚Üì</span>

                        <!-- Hidden field for selected regions -->
                        <input type="hidden" id="selectedBodyRegions" name="selectedBodyRegions" value="">

                        <!-- Fallback Text Input (Initially Hidden) -->
                        <div id="textInputFallback" style="display: none; margin-top: 1rem;">
                            <div class="floating-input">
                                <select id="problemArea" name="problemArea" class="input-field">
                                    <option value="" disabled selected hidden></option>
                                    <option value="neck">Neck & Cervical</option>
                                    <option value="shoulder">Shoulder</option>
                                    <option value="back">Back (Upper/Lower)</option>
                                    <option value="knee">Knee</option>
                                    <option value="ankle">Ankle & Foot</option>
                                    <option value="wrist">Wrist & Hand</option>
                                </select>
                                <label for="problemArea">Affected Area</label>
                            </div>
                        </div>

                        <div class="floating-input">
                            <textarea id="problemStatement" name="problemStatement" required rows="4" placeholder=" "
                                class="input-field textarea"></textarea>
                            <label for="problemStatement">Describe symptoms...</label>
                        </div>

                        <!-- PAIN SCALE -->
                        <div class="pain-scale-container">
                            <label class="pain-label" for="painLevel">Pain Level: <span id="painValueDisplay"
                                    style="color:var(--accent); font-weight:800;">5</span>/10</label>
                            <input type="range" id="painLevel" name="painLevel" min="1" max="10" value="5"
                                class="pain-slider"
                                oninput="document.getElementById('painValueDisplay').innerText = this.value">
                            <div class="pain-markers">
                                <span>üôÇ Mild</span>
                                <span>üòê Moderate</span>
                                <span>üò´ Severe</span>
                            </div>
                        </div>
                    </div>
                    <div class="nav-buttons">
                        <button type="button" class="btn btn-secondary" onclick="nextStep(3)">Back</button>
                        <button type="submit" class="btn btn-primary btn-pulse">Generate Plan ‚ö°</button>
                    </div>
            </div>

            </form>
            </div>
        </section>

        <!-- Loading Section -->
        <section id="loadingSection" class="section hidden">
            <div class="loading-container glass-panel">
                <div class="pulse-icon">ü©∫</div>
                <h3>Analyzing Symptoms...</h3>
                <p>Consulting AI Knowledge Base</p>
            </div>
        </section>

        <!-- Results Section -->
        <section id="resultsSection" class="section hidden">
            <!-- Injected via JavaScript -->
        </section>

    </main>

    <!-- v2.69: EXERCISE REMINDER MODAL -->
    <div class="reminder-modal-overlay" id="reminderModal">
        <div class="reminder-modal">
            <div class="reminder-modal-header">
                <div class="icon">üìÖ</div>
                <h3>Never Miss Your Recovery Exercises!</h3>
                <p>Your plan recommends exercises <span class="highlight" id="exerciseFrequency">3x daily</span></p>
            </div>
            <div class="reminder-options">
                <button class="reminder-option-btn" onclick="setPhoneAlarm()">
                    <span class="icon">üì±</span>
                    <div class="label">
                        <span class="title">Set Phone Alarm</span>
                        <span class="desc">Recommended times: 8 AM, 2 PM, 8 PM</span>
                    </div>
                </button>
                <button class="reminder-option-btn" onclick="downloadCalendar()">
                    <span class="icon">üìÜ</span>
                    <div class="label">
                        <span class="title">Add to Calendar</span>
                        <span class="desc">Download .ics file for Google/Apple Calendar</span>
                    </div>
                </button>
                <button class="reminder-option-btn" onclick="whatsappReminder()">
                    <span class="icon">üí¨</span>
                    <div class="label">
                        <span class="title">WhatsApp Reminder</span>
                        <span class="desc">Send yourself a reminder message</span>
                    </div>
                </button>
            </div>
            <div class="reminder-skip-btn" onclick="closeReminderModal()">
                No thanks, I'll remember
            </div>
        </div>
    </div>

    <div style="text-align: center; color: #cbd5e1; font-size: 0.8rem; padding: 20px;">
        PhysioAssist AI v2.69 (Body Diagram + Reminders) ‚Ä¢ <span id="statusIndicator">System Ready</span>
    </div>
    </div>

    <!-- Scripts Duplicate Removed -->

    <!-- Wizard Logic Script -->
    <script>
        // Floating Label Logic (Consistent across inputs/selects)
        // Floating Label Logic (Optimized v2.21)
        // Uses CSS :valid/:focus mostly, JS only for load/autofill fix
        function initFloatingLabels() {
            const update = (input) => {
                if (input.value && input.value.trim() !== '') {
                    input.classList.add('has-content');
                } else {
                    input.classList.remove('has-content');
                }
            };

            document.querySelectorAll('.input-field').forEach(input => {
                // Only listen to blur (focus out) to avoid Input Lag
                input.addEventListener('blur', () => update(input));
                input.addEventListener('change', () => update(input));

                // Initial check
                setTimeout(() => update(input), 100);
            });
        }
        document.addEventListener('DOMContentLoaded', initFloatingLabels);

        // ========================================
        // v2.69: PERFORMANCE - Defer Animations
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.body.classList.add('animations-ready');
            }, 300);
        });

        // ========================================
        // v2.69: INTERACTIVE BODY DIAGRAM
        // ========================================
        const selectedRegions = new Set();
        const regionData = {}; // Store region names for AI

        // v3.0: SVG View Switching
        function switchSVGView(view) {
            const frontPanel = document.getElementById('frontPanel');
            const backPanel = document.getElementById('backPanel');
            const buttons = document.querySelectorAll('.svg-view-btn');

            buttons.forEach(btn => btn.classList.remove('active'));

            if (view === 'front') {
                frontPanel.classList.add('active');
                backPanel.classList.remove('active');
                buttons[0].classList.add('active');
            } else {
                frontPanel.classList.remove('active');
                backPanel.classList.add('active');
                buttons[1].classList.add('active');
            }
        }

        function initBodyDiagram() {
            // v2.73: Handle SVG regions, body regions, and image hotspots
            const regions = document.querySelectorAll('.body-region, .hotspot, .body-part');
            regions.forEach(region => {
                region.addEventListener('click', (e) => {
                    e.preventDefault();
                    const regionId = region.dataset.region;
                    const regionName = region.dataset.name;

                    if (selectedRegions.has(regionId)) {
                        // Deselect
                        selectedRegions.delete(regionId);
                        delete regionData[regionId];
                        region.classList.remove('selected');
                    } else {
                        // Select
                        selectedRegions.add(regionId);
                        regionData[regionId] = regionName;
                        region.classList.add('selected');
                    }

                    updateSelectedDisplay();
                });
            });
        }

        function updateSelectedDisplay() {
            const display = document.getElementById('selectedRegionsDisplay');
            const tagsContainer = document.getElementById('selectedRegionTags');
            const hiddenInput = document.getElementById('selectedBodyRegions');

            if (selectedRegions.size > 0) {
                display.style.display = 'block';
                tagsContainer.innerHTML = Array.from(selectedRegions).map(id =>
                    `<span class="region-tag">${regionData[id]}</span>`
                ).join('');
                // Store as JSON for form submission
                hiddenInput.value = JSON.stringify(regionData);
            } else {
                display.style.display = 'none';
                hiddenInput.value = '';
            }
        }

        function toggleTextInput() {
            const fallback = document.getElementById('textInputFallback');
            const diagram = document.getElementById('bodyDiagramContainer');
            const hint = document.querySelector('.body-diagram-hint');
            const link = document.querySelector('.skip-diagram-link');

            if (fallback.style.display === 'none') {
                fallback.style.display = 'block';
                link.textContent = 'Use body diagram instead ‚Üë';
            } else {
                fallback.style.display = 'none';
                link.textContent = 'Or type location manually ‚Üì';
            }
        }

        document.addEventListener('DOMContentLoaded', initBodyDiagram);

        // ========================================
        // v2.69: EXERCISE REMINDER SYSTEM
        // ========================================
        let currentPlanData = null; // Stored when plan is generated
        let hasShownReminder = false;

        function showReminderModal(planData) {
            if (hasShownReminder || sessionStorage.getItem('reminderShown')) return;

            currentPlanData = planData;
            const modal = document.getElementById('reminderModal');
            modal.classList.add('active');
            hasShownReminder = true;
            sessionStorage.setItem('reminderShown', 'true');
        }

        function closeReminderModal() {
            const modal = document.getElementById('reminderModal');
            modal.classList.remove('active');
        }

        function setPhoneAlarm() {
            alert('üì± Set alarms on your phone for:\n\n‚Ä¢ 8:00 AM - Morning exercises\n‚Ä¢ 2:00 PM - Afternoon stretches\n‚Ä¢ 8:00 PM - Evening recovery\n\nTip: Name each alarm with your exercise!');
            closeReminderModal();
        }

        function downloadCalendar() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);

            const formatDate = (date, hours) => {
                date.setHours(hours, 0, 0);
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            };

            const exercises = currentPlanData?.exercises?.slice(0, 3)?.map(e => e.name).join(', ') || 'PhysioAssist Exercises';

            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//PhysioAssist//Recovery//EN
BEGIN:VEVENT
UID:physio-morning-${Date.now()}@physioassist
DTSTAMP:${formatDate(new Date(), 8)}
DTSTART:${formatDate(new Date(tomorrow), 8)}
DTEND:${formatDate(new Date(tomorrow), 8).replace('T080000', 'T081500')}
RRULE:FREQ=DAILY;COUNT=30
SUMMARY:üèãÔ∏è Morning Exercises
DESCRIPTION:${exercises}
END:VEVENT
BEGIN:VEVENT
UID:physio-afternoon-${Date.now()}@physioassist
DTSTAMP:${formatDate(new Date(), 14)}
DTSTART:${formatDate(new Date(tomorrow), 14)}
DTEND:${formatDate(new Date(tomorrow), 14).replace('T140000', 'T141500')}
RRULE:FREQ=DAILY;COUNT=30
SUMMARY:üßò Afternoon Stretches
DESCRIPTION:${exercises}
END:VEVENT
BEGIN:VEVENT
UID:physio-evening-${Date.now()}@physioassist
DTSTAMP:${formatDate(new Date(), 20)}
DTSTART:${formatDate(new Date(tomorrow), 20)}
DTEND:${formatDate(new Date(tomorrow), 20).replace('T200000', 'T201500')}
RRULE:FREQ=DAILY;COUNT=30
SUMMARY:üòå Evening Recovery
DESCRIPTION:${exercises}
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'physioassist-reminders.ics';
            link.click();

            closeReminderModal();
        }

        function whatsappReminder() {
            const exercises = currentPlanData?.exercises?.slice(0, 3)?.map(e => `‚Ä¢ ${e.name}`).join('\n') || '‚Ä¢ Your exercises';
            const msg = encodeURIComponent(
                `üè• EXERCISE REMINDER\n\n` +
                `Today's Exercises:\n${exercises}\n\n` +
                `‚è∞ Times: 8 AM, 2 PM, 8 PM\n\n` +
                `üí™ Stay consistent for faster recovery!`
            );
            window.open(`https://wa.me/?text=${msg}`, '_blank');
            closeReminderModal();
        }

        // Expose for app.js to call after plan generation
        window.showReminderModal = showReminderModal;
        window.getSelectedBodyRegions = () => regionData;

        // ========================================
        // v2.69: LANGUAGE SELECTION SYSTEM
        // ========================================
        const TRANSLATIONS = {
            english: {
                // Form Headers
                patientProfile: 'üìã Patient Profile',
                stepIndicator: 'Step {n} of 4',
                nextLifestyle: 'Next: Lifestyle ‚ûî',
                nextMedical: 'Next: Medical History ‚ûî',
                nextSymptoms: 'Next: Symptoms ‚ûî',
                back: 'Back',
                generatePlan: 'Generate Plan ‚ö°',
                // Labels
                fullName: 'Full Name',
                mobile: 'Mobile Number',
                age: 'Age',
                gender: 'Gender',
                weight: 'Weight (kg)',
                height: 'Height (cm)',
                occupation: 'Occupation',
                activity: 'Daily Activity (e.g. Badminton, Yoga, Gardening)',
                dietType: 'Diet Type',
                // Medical
                medicalProfile: 'Medical Profile',
                diabetes: 'Diabetes',
                highBP: 'High BP',
                heartIssue: 'Heart Issue',
                recentSurgery: 'Recent Operations?',
                uploadReport: 'Have an X-Ray, MRI, or Report? (Optional)',
                clickUpload: 'Click to Upload Image/Report (Max 1MB)',
                // Symptoms
                tapHurts: 'üìç Tap Where It Hurts',
                tapMultiple: 'üëÜ Tap multiple areas if pain spreads',
                typeManually: 'Or type location manually ‚Üì',
                describeSymptoms: 'Describe symptoms...',
                painLevel: 'Pain Level',
                mild: 'üôÇ Mild',
                moderate: 'üòê Moderate',
                severe: 'üò´ Severe',
                affectedArea: 'Affected Area',
                // Diet Options
                vegetarian: 'Vegetarian',
                nonVeg: 'Non-Vegetarian',
                vegan: 'Vegan',
                keto: 'Keto',
                // Gender Options
                male: 'Male',
                female: 'Female',
                other: 'Other',
                front: 'Front',
                backBody: 'Back'
            },
            hindi: {
                patientProfile: 'üìã ‡§∞‡•ã‡§ó‡•Ä ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤',
                stepIndicator: '‡§ö‡§∞‡§£ {n} ‡§Æ‡•á‡§Ç ‡§∏‡•á 4',
                nextLifestyle: '‡§Ö‡§ó‡§≤‡§æ: ‡§ú‡•Ä‡§µ‡§®‡§∂‡•à‡§≤‡•Ä ‚ûî',
                nextMedical: '‡§Ö‡§ó‡§≤‡§æ: ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‚ûî',
                nextSymptoms: '‡§Ö‡§ó‡§≤‡§æ: ‡§≤‡§ï‡•ç‡§∑‡§£ ‚ûî',
                back: '‡§µ‡§æ‡§™‡§∏',
                generatePlan: '‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç ‚ö°',
                fullName: '‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ',
                mobile: '‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞',
                age: '‡§â‡§Æ‡•ç‡§∞',
                gender: '‡§≤‡§ø‡§Ç‡§ó',
                weight: '‡§µ‡§ú‡§® (‡§ï‡§ø‡§≤‡•ã)',
                height: '‡§ä‡§Ç‡§ö‡§æ‡§à (‡§∏‡•á‡§Æ‡•Ä)',
                occupation: '‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø',
                activity: '‡§¶‡•à‡§®‡§ø‡§ï ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø (‡§ú‡•à‡§∏‡•á ‡§¨‡•à‡§°‡§Æ‡§ø‡§Ç‡§ü‡§®, ‡§Ø‡•ã‡§ó)',
                dietType: '‡§Ü‡§π‡§æ‡§∞ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞',
                medicalProfile: '‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤',
                diabetes: '‡§°‡§æ‡§Ø‡§¨‡§ø‡§ü‡•Ä‡§ú',
                highBP: '‡§â‡§ö‡•ç‡§ö ‡§∞‡§ï‡•ç‡§§‡§ö‡§æ‡§™',
                heartIssue: '‡§π‡•É‡§¶‡§Ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ',
                recentSurgery: '‡§π‡§æ‡§≤ ‡§ï‡•Ä ‡§∏‡§∞‡•ç‡§ú‡§∞‡•Ä?',
                uploadReport: 'X-Ray, MRI ‡§Ø‡§æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§π‡•à? (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)',
                clickUpload: '‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç (‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ 1MB)',
                tapHurts: 'üìç ‡§¶‡§∞‡•ç‡§¶ ‡§µ‡§æ‡§≤‡•Ä ‡§ú‡§ó‡§π ‡§™‡§∞ ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç',
                tapMultiple: 'üëÜ ‡§ï‡§à ‡§ú‡§ó‡§π ‡§¶‡§∞‡•ç‡§¶ ‡§π‡•ã ‡§§‡•ã ‡§∏‡§≠‡•Ä ‡§™‡§∞ ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç',
                typeManually: '‡§Ø‡§æ ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç ‚Üì',
                describeSymptoms: '‡§≤‡§ï‡•ç‡§∑‡§£ ‡§¨‡§§‡§æ‡§è‡§Ç...',
                painLevel: '‡§¶‡§∞‡•ç‡§¶ ‡§ï‡§æ ‡§∏‡•ç‡§§‡§∞',
                mild: 'üôÇ ‡§π‡§≤‡•ç‡§ï‡§æ',
                moderate: 'üòê ‡§Æ‡§ß‡•ç‡§Ø‡§Æ',
                severe: 'üò´ ‡§ó‡§Ç‡§≠‡•Ä‡§∞',
                affectedArea: '‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§ø‡§§ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞',
                vegetarian: '‡§∂‡§æ‡§ï‡§æ‡§π‡§æ‡§∞‡•Ä',
                nonVeg: '‡§Æ‡§æ‡§Ç‡§∏‡§æ‡§π‡§æ‡§∞‡•Ä',
                vegan: '‡§µ‡•Ä‡§ó‡§®',
                keto: '‡§ï‡•Ä‡§ü‡•ã',
                male: '‡§™‡•Å‡§∞‡•Å‡§∑',
                female: '‡§Æ‡§π‡§ø‡§≤‡§æ',
                other: '‡§Ö‡§®‡•ç‡§Ø',
                front: '‡§∏‡§æ‡§Æ‡§®‡•á',
                backBody: '‡§™‡•Ä‡§õ‡•á'
            },
            hinglish: {
                patientProfile: 'üìã Patient Profile',
                stepIndicator: 'Step {n} of 4',
                nextLifestyle: 'Next: Lifestyle ‚ûî',
                nextMedical: 'Next: Medical History ‚ûî',
                nextSymptoms: 'Next: Symptoms ‚ûî',
                back: 'Back',
                generatePlan: 'Plan Banao ‚ö°',
                fullName: 'Poora Naam',
                mobile: 'Mobile Number',
                age: 'Umar',
                gender: 'Gender',
                weight: 'Wazan (kg)',
                height: 'Height (cm)',
                occupation: 'Kaam/Job',
                activity: 'Daily Activity (jaise Badminton, Yoga)',
                dietType: 'Khana Type',
                medicalProfile: 'Medical History',
                diabetes: 'Sugar/Diabetes',
                highBP: 'High BP',
                heartIssue: 'Heart Problem',
                recentSurgery: 'Recent Surgery hui?',
                uploadReport: 'X-Ray, MRI ya Report hai? (Optional)',
                clickUpload: 'Upload karne ke liye click karo (Max 1MB)',
                tapHurts: 'üìç Jahan dard hai wahan tap karo',
                tapMultiple: 'üëÜ Agar kai jagah dard hai toh sab pe tap karo',
                typeManually: 'Ya manually type karo ‚Üì',
                describeSymptoms: 'Symptoms batao...',
                painLevel: 'Dard Level',
                mild: 'üôÇ Halka',
                moderate: 'üòê Medium',
                severe: 'üò´ Bahut Zyada',
                affectedArea: 'Affected Area',
                vegetarian: 'Shakahari',
                nonVeg: 'Non-Veg',
                vegan: 'Vegan',
                keto: 'Keto',
                male: 'Male',
                female: 'Female',
                other: 'Other',
                front: 'Front',
                backBody: 'Back'
            }
        };

        function selectLanguage(lang) {
            localStorage.setItem('physioLanguage', lang);
            document.getElementById('languagePopup').classList.add('hidden');
            applyTranslations(lang);
        }

        function applyTranslations(lang) {
            const t = TRANSLATIONS[lang] || TRANSLATIONS.english;

            // Update form labels using data attributes
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.dataset.translate;
                if (t[key]) el.textContent = t[key];
            });

            // Update select options
            const genderSelect = document.getElementById('gender');
            if (genderSelect) {
                const options = genderSelect.querySelectorAll('option');
                options.forEach(opt => {
                    if (opt.value === 'male') opt.textContent = t.male;
                    if (opt.value === 'female') opt.textContent = t.female;
                    if (opt.value === 'other') opt.textContent = t.other;
                });
            }

            // Update body diagram labels
            const frontLabel = document.querySelector('.body-diagram-view:first-child h4');
            const backLabel = document.querySelector('.body-diagram-view:last-child h4');
            if (frontLabel) frontLabel.textContent = t.front;
            if (backLabel) backLabel.textContent = t.backBody;

            // Update hints
            const hint = document.querySelector('.body-diagram-hint');
            if (hint) hint.textContent = t.tapMultiple;

            const skipLink = document.querySelector('.skip-diagram-link');
            if (skipLink) skipLink.textContent = t.typeManually;
        }

        // Check if language already selected
        document.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('physioLanguage');
            if (savedLang) {
                document.getElementById('languagePopup').classList.add('hidden');
                applyTranslations(savedLang);
            }
        });

        function nextStep(stepNumber) {
            // Hide all steps
            document.querySelectorAll('.form-step').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.form-step').forEach(el => el.classList.remove('active'));

            // Show target step
            const target = document.getElementById('step' + stepNumber);
            if (target) {
                target.classList.remove('hidden');
                target.classList.add('active');

                // Update indicator
                const lang = localStorage.getItem('physioLanguage') || 'english';
                const t = TRANSLATIONS[lang];
                document.getElementById('stepIndicator').innerText = t.stepIndicator.replace('{n}', stepNumber);

                // PERFORMANCE OPTIMIZATION (v2.10)
                // Initialize Heavy AI Model only AFTER user finishes Step 1 (Typing)
                if (stepNumber === 2 && window.SemanticCore && !window.SemanticCore.isReady) {
                    console.log("‚ö° Triggering Deferred AI Core Init...");
                    window.SemanticCore.init();
                }
            }
        }
    </script>
    <!-- SCRIPTS (Order is Critical) -->
    <script src="config.js?v=final70"></script>
    <script src="openrouter-client.js?v=final70"></script>
    <script src="semantic-core.js?v=final70"></script>
    <script src="ai-engine.js?v=final70"></script>
    <script src="sheets-webhook.js?v=final70"></script>
    <script src="app.js?v=final70"></script>
</body>

</html>